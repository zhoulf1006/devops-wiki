[{"title":"Hello","type":0,"sectionRef":"#","url":"blog/hello-world","content":"Welcome to this blog. This blog is created with Docusaurus 2. This is a test post. A whole bunch of other information.","keywords":""},{"title":"Hola","type":0,"sectionRef":"#","url":"blog/hola","content":"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque elementum dignissim ultricies. Fusce rhoncus ipsum tempor eros aliquam consequat. Lorem ipsum dolor sit amet","keywords":""},{"title":"Welcome","type":0,"sectionRef":"#","url":"blog/welcome","content":"Blog features are powered by the blog plugin. Simply add files to the blog directory. It supports tags as well! Delete the whole directory if you don't want the blog features. As simple as that!","keywords":""},{"title":"Tutorial Intro","type":0,"sectionRef":"#","url":"docs/intro","content":"","keywords":""},{"title":"Getting Started​","type":1,"pageTitle":"Tutorial Intro","url":"docs/intro#getting-started","content":"Get started by creating a new site. Or try Docusaurus immediately with new.docusaurus.io. "},{"title":"Generate a new site​","type":1,"pageTitle":"Tutorial Intro","url":"docs/intro#generate-a-new-site","content":"Generate a new Docusaurus site using the classic template: npx @docusaurus/init@latest init my-website classic Copy "},{"title":"Start your site​","type":1,"pageTitle":"Tutorial Intro","url":"docs/intro#start-your-site","content":"Run the development server: cd my-website npx docusaurus start Copy Your site starts at http://localhost:3000. Open docs/intro.md and edit some lines: the site reloads automatically and display your changes. "},{"title":"K8s Log Management","type":0,"sectionRef":"#","url":"docs/practice/aks/k8s-log-mgmt","content":"","keywords":""},{"title":"log类型​","type":1,"pageTitle":"K8s Log Management","url":"docs/practice/aks/k8s-log-mgmt#log类型","content":"系统组件log 包含在容器中运行的系统组件和不在容器中运行的系统组件(包括容器运行时)。 (1) 在使用 systemd 机制的服务器上，kubelet 和容器 runtime 写入日志到 journald。 如果没有 systemd，他们写入日志到 /var/log 目录的 .log 文件。 (2) 容器中的系统组件通常将日志写到 /var/log 目录，绕过了默认的日志机制。 应用log (1) 如果容器应用log输出到了标准输出，则容器log存放在节点目录/var/lib/docker/containers/CONTAINER-ID/*.log。另外在节点中有创建/var/log/containers/NAMESPACE_POD-NAME-*/POD-NAME/*.log, 这些log文件是指向容器log的连接文件。除了直接去节点里查看log，还可以使用kubectl logs命令去查看对应容器的log。 (2) 如果容器应用log被打印到一个自定义mount路径的volume中，则容器log被存储在节点上对应的路径上，此时使用kubectl logs命令去查看则不会看到任何log。 "},{"title":"需要解决的log问题​","type":1,"pageTitle":"K8s Log Management","url":"docs/practice/aks/k8s-log-mgmt#需要解决的log问题","content":"(1) 实现log的轮转，包括k8s系统log以及应用log，保证log不会消耗节点上所有的存储空间 (2) 提供log持久化存储、分析和查看的解决方案，即集群级日志架构。需要的考虑的问题： log的大小、格式、文件格式等不同microservice如何区分选择何种log架构 "},{"title":"集群级日志架构​","type":1,"pageTitle":"K8s Log Management","url":"docs/practice/aks/k8s-log-mgmt#集群级日志架构","content":"可选的方案： 使用在每个节点上运行的节点级日志记录代理在应用程序的 pod 中，包含专门记录日志的 sidecar 容器将日志直接从应用程序中推送到日志记录后端 使用节点级日志代理​  通过在每个节点上使用 节点级的日志记录代理 来实现群集级日志记录，日志记录代理是一种用于暴露日志或将日志推送到后端的专用工具。 通常，日志记录代理程序是一个容器，它可以访问包含该节点上所有应用程序容器的日志文件的目录。 使用 sidecar 容器和日志代理​ 可以通过以下方式之一使用 sidecar 容器： sidecar 容器将应用程序日志传送到自己的标准输出sidecar 容器运行一个日志代理，配置该日志代理以便从应用容器收集日志 传输数据流的 sidecar 容器​  具有日志代理功能的 sidecar 容器​  从应用中直接暴露日志目录​  References: https://kubernetes.io/zh/docs/concepts/cluster-administration/logging/ https://zdyxry.github.io/2019/05/17/Kubernetes-%E5%AE%9E%E6%88%98-%E6%97%A5%E5%BF%97%E5%A4%84%E7%90%86/ "},{"title":"installation","type":0,"sectionRef":"#","url":"docs/practice/docker/installation","content":"","keywords":""},{"title":"Install on CentOS7​","type":1,"pageTitle":"installation","url":"docs/practice/docker/installation#install-on-centos7","content":"CICD machine including selfci vms on aws and deploy vms on azure are CentOS7. "},{"title":"Install with yum​","type":1,"pageTitle":"installation","url":"docs/practice/docker/installation#install-with-yum","content":"yum install -y yum-utils device-mapper-persistent-data lvm2 yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo yum install -y docker-ce docker-ce-cli containerd.io Copy You may met the following errors Error: Package: audit-libs-python-2.8.5-4.el7.x86_64 (base) Requires: audit-libs(x86-64) = 2.8.5-4.el7 Installed: audit-libs-2.7.6-3.el7.x86_64 (@anaconda) audit-libs(x86-64) = 2.7.6-3.el7 Available: audit-libs-2.4.5-6.el6.x86_64 (aloong-repo) audit-libs(x86-64) = 2.4.5-6.el6 Error: Package: policycoreutils-python-2.5-34.el7.x86_64 (base) Requires: policycoreutils = 2.5-34.el7 Installed: policycoreutils-2.5-33.el7.x86_64 (@base) policycoreutils = 2.5-33.el7 Available: policycoreutils-2.0.83-30.1.el6_8.x86_64 (aloong-repo) policycoreutils = 2.0.83-30.1.el6_8 You could try using --skip-broken to work around the problem You could try running: rpm -Va --nofiles --nodigest Copy Download package and install dependencies wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/audit-libs-2.8.5-4.el7.x86_64.rpm wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/policycoreutils-2.5-34.el7.x86_64.rpm wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/libselinux-utils-2.5-15.el7.x86_64.rpm wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/libsepol-2.5-10.el7.x86_64.rpm wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/libselinux-2.5-15.el7.x86_64.rpm wget https://rpmfind.net/linux/centos/7.9.2009/os/x86_64/Packages/libsemanage-2.5-14.el7.x86_64.rpm # install sequence: libsepol -&gt; libselinux -&gt; libsemanage -&gt; libselinux-utils -&gt; policycoreutils yum install -y libsepol-2.5-10.el7.x86_64.rpm libselinux-2.5-15.el7.x86_64.rpm libsemanage-2.5-14.el7.x86_64.rpm libselinux-utils-2.5-15.el7.x86_64.rpm policycoreutils-2.5-34.el7.x86_64.rpm audit-libs-2.8.5-4.el7.x86_64.rpm Copy Retry install docker yum install -y docker-ce docker-ce-cli containerd.io Copy Disable docker repo after successful installation sudo yum-config-manager --disable docker-ce-stable Copy "},{"title":"Config & Start docker​","type":1,"pageTitle":"installation","url":"docs/practice/docker/installation#config--start-docker","content":"mkdir -p /etc/docker /data/tools/docker cat &lt;&lt; EOF &gt;/etc/docker/daemon.json { &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;data-root&quot;: &quot;data/tools/docker&quot;, &quot;log-driver&quot;: &quot;json-file&quot;, &quot;log-opts&quot;: { &quot;max-size&quot;: &quot;100m&quot; }, &quot;storage-driver&quot;: &quot;overlay2&quot;, &quot;storage-opts&quot;: [ &quot;overlay2.override_kernel_check=true&quot; ] } } EOF #start and enable docker.service systemctl daemon-reload systemctl start docker &amp;&amp; systemctl enable docker sleep 5 #check status systemctl status docker Copy "},{"title":"Install on Ubuntu​","type":1,"pageTitle":"installation","url":"docs/practice/docker/installation#install-on-ubuntu","content":"Some small projects and new machines are ubuntu linux. "},{"title":"Install with apt-get​","type":1,"pageTitle":"installation","url":"docs/practice/docker/installation#install-with-apt-get","content":"sudo apt-get update sudo apt-get install -y \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg-agent \\ software-properties-common curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository \\ &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable&quot; sudo apt-get update sudo apt-get install -y docker-ce docker-ce-cli containerd.io sudo groupadd docker sudo gpasswd -a $USER docker newgrp docker Copy "},{"title":"Check installation​","type":1,"pageTitle":"installation","url":"docs/practice/docker/installation#check-installation","content":"docker -v Copy "},{"title":"Deploy AKS","type":0,"sectionRef":"#","url":"docs/practice/aks/aks-create","content":"Deploy AKS check azure CLI version​ az --version Copy install aks necessary extension​ //list extensions az extension list-available --output table //install aks-preview az extension add --name aks-preview Copy azure CLI login​ az login Copy azure CLI show accounts​ az account show -o table Copy azure CLI set subscription​ az account set --subscription=dev-aloong-us Copy check Azure Monitor related providers registered or not​ az provider show -n Microsoft.OperationsManagement -o table az provider show -n Microsoft.OperationalInsights -o table Copy register Azure Monitor related providers​ az provider register --namespace Microsoft.OperationsManagement az provider register --namespace Microsoft.OperationalInsights Copy create first resource group for kubernetes service resource​ az group create --name rg-aks-aloong-dev-wu --location westus Copy Note: provide the second resource group name when creating the aks cluster if you want. Otherwise, aks cluster will create it automatically with the name like 'MC_resourcegroupname_clustername_location' specify the second resource group for aks cluster infra(nodes, networking and storage etc.) resource-group-name: rg-cas-aks-infra-dev-wu create network and subnet within another resource group​ az group create --name rg-aks-networks-dev-wu --location westus az network vnet create -g rg-aks-networks-dev-wu \\ -n vnet-aks-aloong-dev-wu \\ --address-prefix 10.169.0.0/16 \\ --subnet-name aks-subnet \\ --subnet-prefix 10.169.0.0/17 Copy get the created subnet id​ az network vnet subnet list --resource-group rg-networks-aks-dev-wu \\ --vnet-name vnet-aks-aloong-dev-wu \\ --query &quot;[0].id&quot; --output tsv Copy create public ip prefix(optional)​ az group create --name rg-aks-networks-dev-wu --location westus az network public-ip prefix create --length 30 --location westus --name aks-ip-prefix-dev-wu --resource-group rg-networks-aks-dev-wu Copy get the created ip prefix id​ az network public-ip prefix show --resource-group rg-networks-aks-dev-wu \\ --name aks-ip-prefix-dev-wu \\ --query &quot;id&quot; --output tsv Copy create a service principal​ The service principal is created for acrpull role assignment. We don't need to ceate new one here because we'll use the dev-wu's app sp. az ad sp create-for-rbac --name aks-sp-dev-wu --skip-assignment --years 5 Copy Save the output to a file in case we'll use later. create aks cluster​ az aks create --name aks-aloong-dev-wu \\ --resource-group rg-aks-aloong-dev-wu \\ --kubernetes-version 1.22.4 \\ --location westus \\ --vm-set-type VirtualMachineScaleSets \\ --node-vm-size Standard_DS2_v2 \\ --node-osdisk-size 512 \\ --nodepool-name linuxpool1 \\ --node-resource-group rg-aks-infra-aloong-dev-wu \\ --node-count 2 \\ --enable-cluster-autoscaler \\ --min-count 2 \\ --max-count 10 \\ --admin-username casuser \\ --generate-ssh-keys \\ --service-principal &lt;sp-id&gt; \\ --client-secret &lt;sp-password&gt; \\ --network-plugin azure \\ --vnet-subnet-id &lt;sunet-id&gt; \\ --service-cidr 10.170.0.0/24 \\ --dns-service-ip 10.170.0.10 \\ --docker-bridge-address 172.17.0.1/16 \\ --load-balancer-sku standard \\ --attach-acr casdevreg \\ --dns-name-prefix aks-aloong-dev-wu \\ --enable-addons monitoring Copy install kubectl​ install-cli should run with sudo sudo az aks install-cli Copy configure kubectl to connect to aks cluster​ get-credentials get the credentials for specific aks cluster and store them under current user's ${HOME}/.kube/config az aks get-credentials --resource-group rg-aks-aloong-dev-wu --name aks-aloong-dev-wu Copy delete aks cluster​ az aks delete --name aks-aloong-dev-wu --resource-group rg-aks-aloong-dev-wu Copy","keywords":""},{"title":"Introduction","type":0,"sectionRef":"#","url":"docs/practice/index","content":"Introduction DevOps Practice in CAS","keywords":""},{"title":"test11","type":0,"sectionRef":"#","url":"docs/test1/test11","content":"test11 test11","keywords":""},{"title":"Resize xfs Root Partition","type":0,"sectionRef":"#","url":"docs/practice/linux/resize-root-partition-on-xfs","content":"","keywords":""},{"title":"Resize disk​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#resize-disk","content":""},{"title":"Check your filesystem size​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#check-your-filesystem-size","content":"df -hT Filesystem Type Size Used Avail Use% Mounted on /dev/sda2 xfs 30G 27G 2.6G 92% / Copy In this case , our target disk is /dev/sda2 which means: /dev/sda partition: 2 "},{"title":"Check your disk size​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#check-your-disk-size","content":"lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT fd0 2:0 1 4K 0 disk sda 8:0 0 30G 0 disk ├─sda1 8:1 0 500M 0 part /boot └─sda2 8:2 0 29.5G 0 part / Copy "},{"title":"Stop your vm on azure portal​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#stop-your-vm-on-azure-portal","content":" "},{"title":"Enter disk settings from vm​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#enter-disk-settings-from-vm","content":" "},{"title":"Resize your disk size​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#resize-your-disk-size","content":"Because this is the /root disk, it could only be resized when the vm is stopped. "},{"title":"Start your vm on azure portal​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#start-your-vm-on-azure-portal","content":""},{"title":"Extend xfs filesystem​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#extend-xfs-filesystem","content":""},{"title":"install tools and resize​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#install-tools-and-resize","content":"yum Install cloud-utils-growpart -y # extend your disk growpart /dev/sda 2 # extend your filesystem xfs_growfs -d /dev/sda2 Copy "},{"title":"Check your disk size again​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#check-your-disk-size-again","content":"lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT fd0 2:0 1 4K 0 disk sda 8:0 0 128G 0 disk ├─sda1 8:1 0 500M 0 part /boot └─sda2 8:2 0 127.5G 0 part / # notice the `SIZE` is extended Copy "},{"title":"Check your filesystem again​","type":1,"pageTitle":"Resize xfs Root Partition","url":"docs/practice/linux/resize-root-partition-on-xfs#check-your-filesystem-again","content":"df -h Filesystem Size Used Avail Use% Mounted on /dev/sda2 128G 27G 101G 22% / # notice the `SIZE` is extended Copy "},{"title":"test12","type":0,"sectionRef":"#","url":"docs/test1/test12","content":"test12 test12","keywords":""},{"title":"test132","type":0,"sectionRef":"#","url":"docs/test1/test13/test132","content":"test132 test132","keywords":""},{"title":"test131","type":0,"sectionRef":"#","url":"docs/test1/test13/test131","content":"test131 test131","keywords":""}]